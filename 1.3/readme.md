# Запуск и управление приложениями nginx и multitool в microK8s

### Создание Deployment с двумя контейнерами
- Создан Deployment `nginx-multitool`, состоящий из двух контейнеров: nginx и multitool (wbitt/network-multitool).
- Контейнер multitool настроен с переменной окружения `HTTP_PORT=8080` и соответствующим портом.

https://github.com/DioRoman/kubernetes/blob/main/1.3/deployment.yaml

Командой создаем ресурс deployment

`microk8s.kubectl apply -f deployment.yaml`

Командой увеличиваем количество replicas

`microk8s.kubectl scale deployment/nginx-multitool --replicas=2`

<img width="788" height="70" alt="Снимок экрана 2025-10-03 181604" src="https://github.com/user-attachments/assets/89e775b5-3a41-449f-805f-f1adeaab8892" />

<img width="902" height="147" alt="Снимок экрана 2025-10-03 181610" src="https://github.com/user-attachments/assets/f0aff7c9-b042-4303-8177-ddf155b7d5be" />

### Настройка Service для доступа к приложениям
- Создан Kubernetes Service с двумя портами (80 для nginx и 8080 для multitool) с типом NodePort для доступа к приложениям внутри и снаружи кластера.

https://github.com/DioRoman/kubernetes/blob/main/1.3/service.yaml

- Проверено, что сервис связан с подами через корректные селекторы меток.

### Тестирование сетевого взаимодействия
- Создан отдельный Pod с контейнером multitool для теста доступа к сервисам nginx и multitool внутри кластера.

https://github.com/DioRoman/kubernetes/blob/main/1.3/multitool-pod.yaml

- Использован `curl` изнутри этого Pod для проверки доступности сервисов по соответствующим портам.

<img width="1524" height="806" alt="Снимок экрана 2025-10-03 184517" src="https://github.com/user-attachments/assets/4f15b4bc-1fcf-474f-b546-262830237bdd" />

### Init-контейнер и его назначение
- В Deployment добавлен init-контейнер на базе busybox, который выполняется до запуска основных контейнеров.
- Init-контейнер проверяет доступность сервиса приложения через DNS-запросы и не завершается, пока сервис не станет доступен.
- Такой механизм обеспечивает контроль запуска: основные контейнеры (nginx и multitool) стартуют только после успешного выполнения init-контейнера.
- Init-контейнеры предназначены для подготовки окружения или выполнения предварительных условий, отделяя вспомогательные задачи от основного приложения и увеличивая надёжность запуска.

<img width="721" height="218" alt="Снимок экрана 2025-10-03 203345" src="https://github.com/user-attachments/assets/fd5a4ba2-763d-443b-a4f8-55d663121df4" />

***
Таким образом, благодаря init-контейнеру реализован точный контроль последовательности запуска компонентов и подготовка условий для стабильной работы микросервисов в microK8s.

Init-контейнеры запускаются последовательно и должны успешно завершиться, чтобы основной контейнер мог стартовать. Они эффективны для выполнения задач инициализации, таких как ожидание сервисов, подготовка конфига, или выполнение миграций, что упрощает управление сложными приложениями в Kubernetes.

Такой подход обеспечивает надёжный запуск, масштабируемость и доступность сервисов nginx и multitool в среде microK8s, подходящей для локальной разработки и тестирования микросервисов. 

MicroK8s позволяет эффективно управлять Kubernetes-объектами и сервисами с минимальным расходом ресурсов и быстрой настройкой.
