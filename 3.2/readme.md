### 1. Развёртывание инфраструктуры в Yandex Cloud (Terraform)

https://github.com/DioRoman/kubernetes/blob/main/terraform/main.tf

Для создания сетевой основы и защиты задействуется Terraform‑модуль `yandex-vpc`:
- **VPC, подсеть:** создаётся одна виртуальная сеть и подсеть по заданному CIDR.
- **Группа безопасности:** открывает необходимые порты для Kubernetes (API, kubelet, scheduler, controller, etcd, NodePort‑сервисы), SSH‑доступ, сервисы MicroK8s. Исходящие соединения разрешены во все направления.
- **Виртуальные машины:** модуль `kubernetes` поднимает 1 мастер‑узел, модуль `kubernetes-nodes` — 4 рабочих узла на базе Ubuntu, с нужными метками и единой группой безопасности. Ветвление модулей по ролям узлов и подаче SSH‑ключа через cloud-init упрощает автоматизацию.

**Результат:**  
Одна сеть и подсеть, универсальная группа безопасности, 1 мастер и 4 рабочих узла в облаке, полностью готовых к инициализации.

<img width="1625" height="420" alt="Снимок экрана 2025-10-28 191548" src="https://github.com/user-attachments/assets/26e30174-32a3-405c-9bb5-b30a78be4938" />

***

### 2. Установка и настройка master-узла (Ansible)

https://github.com/DioRoman/kubernetes/blob/main/ansible/install-master.yml

Playbook Ansible автоматизирует подготовку управления и запуск основного узла кластера:
- **Установка зависимостей:** обновляются базовые пакеты, добавляются репозитории и ключи для Kubernetes и containerd.
- **Установка containerd:** ставится контейнерный рантайм, включается SystemdCgroup для совместимости с kubelet.
- **Установка Kubernetes компонентов:** инсталлируются kubelet, kubeadm, kubectl; их версии фиксируются, чтобы избежать неожиданных обновлений.
- **Подготовка ОС:** отключение swap, настройка модулей ядра и sysctl‑параметров, необходимых для работы сетевого плагина Calico.
- **Инициализация кластера:** `kubeadm init` с Calico‑сетью и socket‑containerd, подготовка конфига для пользователя.
- **Сетевой плагин:** применение Calico CNI с официального манифеста — готовит кластер к работе и защищённой сетевой политике.

**Результат:**  
Мастер‑узел проходит все этапы подготовки ОС и ПО, успешно инициализируется и автоматически настраивает сетевую связность Calico.

<img width="1227" height="493" alt="Снимок экрана 2025-10-28 194712" src="https://github.com/user-attachments/assets/f582109a-61fb-4779-a073-f5287d58ccab" />

<img width="920" height="332" alt="Снимок экрана 2025-10-28 194724" src="https://github.com/user-attachments/assets/6a66f9ca-5788-43b7-9d79-da98d9b5dbf2" />

***

### 3. Установка и настройка рабочих узлов (Ansible)

https://github.com/DioRoman/kubernetes/blob/main/ansible/install-node.yml

Следующий playbook Ansible автоматизирует подключение рабочих нод к кластеру:
- **Установка компонентов:** повторяются шаги по установке containerd и базовых утилит, а также ключей и репозиториев Kubernetes.
- **Подготовка ОС и контейнерного рантайма:** удаление старых конфигов, настройка SystemdCgroup и перезапуск containerd.
- **Формирование сетевых и ОС‑параметров:** отключение swap, настройка sysctl, загрузка сетевых модулей, обновление `/etc/hosts`.
- **Очистка старого Kubernetes состояния:** удаление старых конфигураций, размонтирование старых pod‑монтировок — для «чистого» вступления в кластер.
- **Присоединение к кластеру:** выполнение предоставленной мастером команды `kubeadm join` и проверка статуса присоединения.

**Результат:**  
Рабочий узел автоматически подготавливается, очищается от старых состояний и корректно интегрируется в кластер, полностью готов к обработке нагрузки.

<img width="1332" height="64" alt="Снимок экрана 2025-10-28 195608" src="https://github.com/user-attachments/assets/cd832d0d-6488-461e-8f1b-5694b94f4eec" />

<img width="1205" height="628" alt="Снимок экрана 2025-10-28 204635" src="https://github.com/user-attachments/assets/7e07a409-425c-44bc-91a4-72e5633d1b51" />

<img width="631" height="181" alt="Снимок экрана 2025-10-28 204645" src="https://github.com/user-attachments/assets/45a3cbce-b96b-4abe-9d98-70a78bf7887a" />
