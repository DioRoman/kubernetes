### 1. Установка и настройка MicroK8s install-MicroK8S.yml

Это playbook устанавливает MicroK8s, включает Dashboard и Ingress, создаёт админ‑доступ к дашборду и настраивает удобный порт‑форвардинг, а также ставит Helm и подготавливает kubeconfig для пользователя.

### Шаги установки
- Обновление пакетов и установка snapd для работы с MicroK8s.
- Установка MicroK8s через snap и добавление пользователя в группу microk8s.
- Запуск MicroK8s и ожидание готовности кластера командой status --wait-ready.

### Сетевые аддоны
- Включение аддонов Dashboard и Ingress для UI и публикации сервисов.
- Ожидание готовности Pod'ов Dashboard в namespace kube-system.

### Доступ к Dashboard
- Создание service account и ClusterRoleBinding с ролью cluster-admin для доступа к UI.
- Генерация токена доступа с длительностью, заданной переменной token_duration.
- Организация port-forward сервиса kubernetes-dashboard на порт dashboard_port, плюс скрипт для ручного запуска.

### Клиентская конфигурация
- Создание ~/.kube и копирование client.config в kubeconfig пользователя для работы kubectl.
- Добавление путей /snap/bin и /usr/local/bin в PATH для удобного запуска microk8s/kubectl/helm.

### Установка Helm
- Загрузка и запуск официального скрипта установки Helm v3, добавление бинарника в PATH.

### Завершение
- Вывод URL дашборда и сгенерированного токена; копирование директории myapp пользователю для дальнейшего деплоя.

***

### 2. Установка и настройка master-узла (Ansible) install-master.yml

Playbook Ansible автоматизирует подготовку управления и запуск основного узла кластера:
- **Установка зависимостей:** обновляются базовые пакеты, добавляются репозитории и ключи для Kubernetes и containerd.
- **Установка containerd:** ставится контейнерный рантайм, включается SystemdCgroup для совместимости с kubelet.
- **Установка Kubernetes компонентов:** инсталлируются kubelet, kubeadm, kubectl; их версии фиксируются, чтобы избежать неожиданных обновлений.
- **Подготовка ОС:** отключение swap, настройка модулей ядра и sysctl‑параметров, необходимых для работы сетевого плагина Calico.
- **Инициализация кластера:** `kubeadm init` с Calico‑сетью и socket‑containerd, подготовка конфига для пользователя.
- **Сетевой плагин:** применение Calico CNI с официального манифеста — готовит кластер к работе и защищённой сетевой политике.

**Результат:**  
Мастер‑узел проходит все этапы подготовки ОС и ПО, успешно инициализируется и автоматически настраивает сетевую связность Calico.

***

### 3. Установка и настройка рабочих узлов (Ansible) install-node.yml

Следующий playbook Ansible автоматизирует подключение рабочих нод к кластеру:
- **Установка компонентов:** повторяются шаги по установке containerd и базовых утилит, а также ключей и репозиториев Kubernetes.
- **Подготовка ОС и контейнерного рантайма:** удаление старых конфигов, настройка SystemdCgroup и перезапуск containerd.
- **Формирование сетевых и ОС‑параметров:** отключение swap, настройка sysctl, загрузка сетевых модулей, обновление `/etc/hosts`.
- **Очистка старого Kubernetes состояния:** удаление старых конфигураций, размонтирование старых pod‑монтировок — для «чистого» вступления в кластер.
- **Присоединение к кластеру:** выполнение предоставленной мастером команды `kubeadm join` и проверка статуса присоединения.

**Результат:**  
Рабочий узел автоматически подготавливается, очищается от старых состояний и корректно интегрируется в кластер, полностью готов к обработке нагрузки.

***

Такой подход обеспечивает унифицированный и автоматизированный развёртывание кластера Kubernetes в Yandex Cloud, соответствующий production best practices и требованиям к безопасности и масштабируемости.