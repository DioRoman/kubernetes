### 1. Развёртывание инфраструктуры в Yandex Cloud (Terraform)

Для создания сетевой основы и защиты задействуется Terraform‑модуль `yandex-vpc`:
- **VPC, подсеть:** создаётся одна виртуальная сеть и подсеть по заданному CIDR.
- **Группа безопасности:** открывает необходимые порты для Kubernetes (API, kubelet, scheduler, controller, etcd, NodePort‑сервисы), SSH‑доступ, сервисы MicroK8s. Исходящие соединения разрешены во все направления.
- **Виртуальные машины:** модуль `kubernetes` поднимает 1 мастер‑узел, модуль `kubernetes-nodes` — 4 рабочих узла на базе Ubuntu, с нужными метками и единой группой безопасности. Ветвление модулей по ролям узлов и подаче SSH‑ключа через cloud-init упрощает автоматизацию.

**Результат:**  
Одна сеть и подсеть, универсальная группа безопасности, 1 мастер и 4 рабочих узла в облаке, полностью готовых к инициализации.

***

### 2. Установка и настройка master-узла (Ansible)

Playbook Ansible автоматизирует подготовку управления и запуск основного узла кластера:
- **Установка зависимостей:** обновляются базовые пакеты, добавляются репозитории и ключи для Kubernetes и containerd.
- **Установка containerd:** ставится контейнерный рантайм, включается SystemdCgroup для совместимости с kubelet.
- **Установка Kubernetes компонентов:** инсталлируются kubelet, kubeadm, kubectl; их версии фиксируются, чтобы избежать неожиданных обновлений.
- **Подготовка ОС:** отключение swap, настройка модулей ядра и sysctl‑параметров, необходимых для работы сетевого плагина Calico.
- **Инициализация кластера:** `kubeadm init` с Calico‑сетью и socket‑containerd, подготовка конфига для пользователя.
- **Сетевой плагин:** применение Calico CNI с официального манифеста — готовит кластер к работе и защищённой сетевой политике.

**Результат:**  
Мастер‑узел проходит все этапы подготовки ОС и ПО, успешно инициализируется и автоматически настраивает сетевую связность Calico.

***

### 3. Установка и настройка рабочих узлов (Ansible)

Следующий playbook Ansible автоматизирует подключение рабочих нод к кластеру:
- **Установка компонентов:** повторяются шаги по установке containerd и базовых утилит, а также ключей и репозиториев Kubernetes.
- **Подготовка ОС и контейнерного рантайма:** удаление старых конфигов, настройка SystemdCgroup и перезапуск containerd.
- **Формирование сетевых и ОС‑параметров:** отключение swap, настройка sysctl, загрузка сетевых модулей, обновление `/etc/hosts`.
- **Очистка старого Kubernetes состояния:** удаление старых конфигураций, размонтирование старых pod‑монтировок — для «чистого» вступления в кластер.
- **Присоединение к кластеру:** выполнение предоставленной мастером команды `kubeadm join` и проверка статуса присоединения.

**Результат:**  
Рабочий узел автоматически подготавливается, очищается от старых состояний и корректно интегрируется в кластер, полностью готов к обработке нагрузки.

***

Такой подход обеспечивает унифицированный и автоматизированный развёртывание кластера Kubernetes в Yandex Cloud, соответствующий production best practices и требованиям к безопасности и масштабируемости.